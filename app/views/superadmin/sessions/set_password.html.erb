<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Forgot Password</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen flex items-center justify-center bg-gray-50">

  <div class="bg-white p-8 rounded-2xl shadow-lg w-[500px]">
    <div class="flex flex-col items-center mb-6">
      <span class="text-4xl mb-2">üîë</span>
      <h2 class="text-2xl font-semibold text-gray-800">Forgot Password</h2>
    </div>

    <%= form_with url: superadmin_sessions_set_password_path, method: :post, class: "space-y-5", local: true, id: "otpForm" do |f| %>
      <input type="hidden" value="<%= @email %>" name="email">

      <!-- New Password -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          New Password <span class="text-red-500">*</span>
        </label>
        <%= f.password_field :password, id: "password", placeholder: "New Password",
          class: "w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
      </div>

      <!-- Confirm Password -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Confirm Password <span class="text-red-500">*</span>
        </label>
        <%= f.password_field :password_confirmation, id: "confirmPassword", placeholder: "Confirm New Password",
          class: "w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
        <p id="matchMessage" class="text-sm mt-1"></p>
      </div>

      <!-- Password Rules -->
      <div class="text-sm leading-relaxed">
        <p class="font-semibold mb-1">Password must contain:</p>
        <ul class="list-disc ml-5 space-y-1">
          <li id="length" class="text-red-500">Minimum 8 characters</li>
          <li id="uppercase" class="text-red-500">One uppercase (A‚ÄìZ)</li>
          <li id="lowercase" class="text-red-500">One lowercase (a‚Äìz)</li>
          <li id="number" class="text-red-500">One number (0‚Äì9)</li>
          <li id="special" class="text-red-500">One special character (@$!%*?&)</li>
        </ul>
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        id="submitBtn"
        disabled
        class="w-full bg-gray-400 text-white py-2 rounded-lg transition font-medium cursor-not-allowed"
      >
        Reset Password
      </button>
    <% end %>

    <!-- Go Back Link -->
    <p class="text-center text-sm text-gray-600 mt-5">
      Go Back?
      <%= link_to "Login", superadmin_sessions_login_path, class: "text-indigo-600 hover:underline font-medium" %>
    </p>
  </div>

  <script>
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirmPassword");
    const submitBtn = document.getElementById("submitBtn");
    const matchMessage = document.getElementById("matchMessage");

    const rules = {
      length: document.getElementById("length"),
      uppercase: document.getElementById("uppercase"),
      lowercase: document.getElementById("lowercase"),
      number: document.getElementById("number"),
      special: document.getElementById("special")
    };

    function validatePassword() {
      const value = password.value;

      // Validation checks
      const validations = {
        length: value.length >= 8,
        uppercase: /[A-Z]/.test(value),
        lowercase: /[a-z]/.test(value),
        number: /[0-9]/.test(value),
        special: /[@$!%*?&]/.test(value)
      };

      // Update UI colors
      for (let key in validations) {
        rules[key].classList.toggle("text-green-600", validations[key]);
        rules[key].classList.toggle("text-red-500", !validations[key]);
      }

      // Check confirm password match
      validateConfirmPassword();

      // Enable submit button if all rules pass
      const allValid = Object.values(validations).every(Boolean);
      const passwordsMatch = password.value && password.value === confirmPassword.value;

      if (allValid && passwordsMatch) {
        submitBtn.disabled = false;
        submitBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
        submitBtn.classList.add("bg-indigo-600", "hover:bg-indigo-700");
      } else {
        submitBtn.disabled = true;
        submitBtn.classList.add("bg-gray-400", "cursor-not-allowed");
        submitBtn.classList.remove("bg-indigo-600", "hover:bg-indigo-700");
      }
    }

    function validateConfirmPassword() {
      if (!confirmPassword.value) {
        matchMessage.textContent = "";
        return;
      }

      if (confirmPassword.value === password.value) {
        matchMessage.textContent = "‚úÖ Passwords match";
        matchMessage.className = "text-green-600 text-sm mt-1";
      } else {
        matchMessage.textContent = "‚ùå Passwords do not match";
        matchMessage.className = "text-red-500 text-sm mt-1";
      }
    }

    password.addEventListener("input", validatePassword);
    confirmPassword.addEventListener("input", validatePassword);
  </script>

</body>
</html>
